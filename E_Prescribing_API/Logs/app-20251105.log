2025-11-05T00:46:36.3192596+02:00  [INF] User profile is available. Using '"C:\Users\ThatoTs\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest. (7ac5e29c)
2025-11-05T00:46:36.5987102+02:00  [INF] Now listening on: "https://localhost:7150" (d826f4b8)
2025-11-05T00:46:36.6009914+02:00  [INF] Now listening on: "http://localhost:5031" (d826f4b8)
2025-11-05T00:46:36.6613447+02:00  [INF] Application started. Press Ctrl+C to shut down. (dcaefe54)
2025-11-05T00:46:36.6645528+02:00  [INF] Hosting environment: "Development" (bc5a1a4e)
2025-11-05T00:46:36.6666270+02:00  [INF] Content root path: "D:\HomeSpace\E_Prescribing_API\E_Prescribing_API" (cc26f24e)
2025-11-05T00:46:37.7616136+02:00 0HNGRUG1CHN2J:00000003 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - null null (d509f86a)
2025-11-05T00:46:37.9390621+02:00 0HNGRUG1CHN2J:00000003 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - 301 0 null 185.1067ms (74253ad3)
2025-11-05T00:46:37.9654914+02:00 0HNGRUG1CHN2J:00000005 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - null null (d509f86a)
2025-11-05T00:46:38.0470335+02:00 0HNGRUG1CHN2J:00000005 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - 200 null "text/html;charset=utf-8" 81.6553ms (74253ad3)
2025-11-05T00:46:38.0823017+02:00 0HNGRUG1CHN2J:00000007 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - null null (d509f86a)
2025-11-05T00:46:38.0870981+02:00 0HNGRUG1CHN2J:00000007 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - 200 13770 "application/javascript; charset=utf-8" 5.2138ms (74253ad3)
2025-11-05T00:46:38.0898921+02:00 0HNGRUG1CHN2J:00000009 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - null null (d509f86a)
2025-11-05T00:46:38.0923144+02:00 0HNGRUG1CHN2J:0000000B [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - null null (d509f86a)
2025-11-05T00:46:38.1066873+02:00 0HNGRUG1CHN2J:00000009 [INF] Sending file. Request path: '"/swagger-ui.css"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T00:46:38.1069510+02:00 0HNGRUG1CHN2J:00000009 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - 499 152034 "text/css" 17.3796ms (74253ad3)
2025-11-05T00:46:38.1367928+02:00 0HNGRUG1CHN2J:0000000B [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - 200 null "text/javascript; charset=UTF-8" 44.743ms (74253ad3)
2025-11-05T00:46:38.2103568+02:00 0HNGRUG1CHN2J:0000000D [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-32x32.png""" - null null (d509f86a)
2025-11-05T00:46:38.2117958+02:00 0HNGRUG1CHN2J:0000000D [INF] Sending file. Request path: '"/favicon-32x32.png"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T00:46:38.2119147+02:00 0HNGRUG1CHN2J:0000000D [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-32x32.png""" - 200 628 "image/png" 1.973ms (74253ad3)
2025-11-05T00:46:38.2458935+02:00 0HNGRUG1CHN2J:0000000F [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - null null (d509f86a)
2025-11-05T00:46:38.3441562+02:00 0HNGRUG1CHN2J:0000000F [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - 200 null "application/json;charset=utf-8" 98.6682ms (74253ad3)
2025-11-05T00:51:51.9201361+02:00  [INF] User profile is available. Using '"C:\Users\ThatoTs\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest. (7ac5e29c)
2025-11-05T00:51:52.2323762+02:00  [INF] Now listening on: "https://localhost:7150" (d826f4b8)
2025-11-05T00:51:52.2347041+02:00  [INF] Now listening on: "http://localhost:5031" (d826f4b8)
2025-11-05T00:51:52.3307585+02:00  [INF] Application started. Press Ctrl+C to shut down. (dcaefe54)
2025-11-05T00:51:52.3337238+02:00  [INF] Hosting environment: "Development" (bc5a1a4e)
2025-11-05T00:51:52.3360420+02:00  [INF] Content root path: "D:\HomeSpace\E_Prescribing_API\E_Prescribing_API" (cc26f24e)
2025-11-05T00:51:53.6805378+02:00 0HNGRUIVGES83:00000003 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - null null (d509f86a)
2025-11-05T00:51:53.8425818+02:00 0HNGRUIVGES83:00000003 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - 301 0 null 166.6386ms (74253ad3)
2025-11-05T00:51:53.8533032+02:00 0HNGRUIVGES83:00000005 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - null null (d509f86a)
2025-11-05T00:51:53.9583196+02:00 0HNGRUIVGES83:00000005 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - 200 null "text/html;charset=utf-8" 105.1202ms (74253ad3)
2025-11-05T00:51:53.9930478+02:00 0HNGRUIVGES83:00000007 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - null null (d509f86a)
2025-11-05T00:51:53.9969185+02:00 0HNGRUIVGES83:00000009 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - null null (d509f86a)
2025-11-05T00:51:54.0070249+02:00 0HNGRUIVGES83:0000000B [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - null null (d509f86a)
2025-11-05T00:51:54.0079383+02:00 0HNGRUIVGES83:00000007 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - 200 13770 "application/javascript; charset=utf-8" 15.2766ms (74253ad3)
2025-11-05T00:51:54.0243685+02:00 0HNGRUIVGES83:00000009 [INF] Sending file. Request path: '"/swagger-ui.css"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T00:51:54.0244957+02:00 0HNGRUIVGES83:00000009 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - 499 152034 "text/css" 27.8896ms (74253ad3)
2025-11-05T00:51:54.0658184+02:00 0HNGRUIVGES83:0000000B [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - 200 null "text/javascript; charset=UTF-8" 59.1824ms (74253ad3)
2025-11-05T00:51:54.1672917+02:00 0HNGRUIVGES83:0000000D [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-32x32.png""" - null null (d509f86a)
2025-11-05T00:51:54.1698100+02:00 0HNGRUIVGES83:0000000D [INF] Sending file. Request path: '"/favicon-32x32.png"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T00:51:54.1699991+02:00 0HNGRUIVGES83:0000000D [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-32x32.png""" - 499 628 "image/png" 2.862ms (74253ad3)
2025-11-05T00:51:54.2114434+02:00 0HNGRUIVGES83:0000000F [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - null null (d509f86a)
2025-11-05T00:51:54.3680286+02:00 0HNGRUIVGES83:0000000F [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - 200 null "application/json;charset=utf-8" 156.8897ms (74253ad3)
2025-11-05T00:56:41.7733327+02:00 0HNGRUIVGES84:00000003 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T00:56:41.7888823+02:00 0HNGRUIVGES84:00000003 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T00:56:41.8271843+02:00 0HNGRUIVGES84:00000003 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T00:56:42.1712981+02:00 0HNGRUIVGES84:00000003 [WRN] Unknown step 0 in admission process (4e65c9b0)
2025-11-05T00:56:42.1780760+02:00 0HNGRUIVGES84:00000003 [INF] Executing "BadRequestObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T00:56:42.1848834+02:00 0HNGRUIVGES84:00000003 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 352.2051ms (afa2e885)
2025-11-05T00:56:42.1850630+02:00 0HNGRUIVGES84:00000003 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T00:56:42.1871661+02:00 0HNGRUIVGES84:00000003 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 400 null "text/plain; charset=utf-8" 414.0353ms (74253ad3)
2025-11-05T00:57:13.9504944+02:00 0HNGRUIVGES84:00000005 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T00:57:13.9520591+02:00 0HNGRUIVGES84:00000005 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T00:57:13.9522876+02:00 0HNGRUIVGES84:00000005 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T00:57:15.9800047+02:00 0HNGRUIVGES84:00000005 [INF] Executed DbCommand ("100"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PatientMedications] ([MedicationId], [PatientId])
OUTPUT INSERTED.[PatientMedicationId]
VALUES (@p0, @p1);" (0723d8ff)
2025-11-05T00:57:16.0815007+02:00 0HNGRUIVGES84:00000005 [ERR] An exception occurred in the database while saving changes for context type '"E_Prescribing_API.Data.ApplicationDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_PatientMedications_Medications_MedicationId\". The conflict occurred in database \"E_Prescribing_API\", table \"dbo.Medications\", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
2025-11-05T00:57:16.1887891+02:00 0HNGRUIVGES84:00000005 [ERR] Error while admitting patient (a2588e81)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T00:57:16.1923142+02:00 0HNGRUIVGES84:00000005 [INF] Executing "ObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T00:57:16.1935820+02:00 0HNGRUIVGES84:00000005 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 2241.029ms (afa2e885)
2025-11-05T00:57:16.1940891+02:00 0HNGRUIVGES84:00000005 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T00:57:16.2006312+02:00 0HNGRUIVGES84:00000005 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 500 null "text/plain; charset=utf-8" 2250.1964ms (74253ad3)
2025-11-05T00:58:21.1338264+02:00 0HNGRUIVGES84:00000007 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T00:58:21.1397582+02:00 0HNGRUIVGES84:00000007 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T00:58:21.1398867+02:00 0HNGRUIVGES84:00000007 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T00:58:21.2404342+02:00 0HNGRUIVGES84:00000007 [INF] Executed DbCommand ("10"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PatientMedications] ([MedicationId], [PatientId])
OUTPUT INSERTED.[PatientMedicationId]
VALUES (@p0, @p1);" (0723d8ff)
2025-11-05T00:58:21.2579108+02:00 0HNGRUIVGES84:00000007 [ERR] An exception occurred in the database while saving changes for context type '"E_Prescribing_API.Data.ApplicationDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_PatientMedications_Medications_MedicationId\". The conflict occurred in database \"E_Prescribing_API\", table \"dbo.Medications\", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T00:58:21.3226496+02:00 0HNGRUIVGES84:00000007 [ERR] Error while admitting patient (a2588e81)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T00:58:21.3230246+02:00 0HNGRUIVGES84:00000007 [INF] Executing "ObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T00:58:21.3231432+02:00 0HNGRUIVGES84:00000007 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 183.2159ms (afa2e885)
2025-11-05T00:58:21.3231721+02:00 0HNGRUIVGES84:00000007 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T00:58:21.3234139+02:00 0HNGRUIVGES84:00000007 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 500 null "text/plain; charset=utf-8" 189.7282ms (74253ad3)
2025-11-05T01:00:02.8208090+02:00 0HNGRUIVGES84:00000009 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T01:00:02.8263404+02:00 0HNGRUIVGES84:00000009 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T01:00:02.8264677+02:00 0HNGRUIVGES84:00000009 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T01:00:02.8550187+02:00 0HNGRUIVGES84:00000009 [INF] Executed DbCommand ("8"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PatientMedications] ([MedicationId], [PatientId])
OUTPUT INSERTED.[PatientMedicationId]
VALUES (@p0, @p1);" (0723d8ff)
2025-11-05T01:00:02.8746715+02:00 0HNGRUIVGES84:00000009 [ERR] An exception occurred in the database while saving changes for context type '"E_Prescribing_API.Data.ApplicationDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_PatientMedications_Medications_MedicationId\". The conflict occurred in database \"E_Prescribing_API\", table \"dbo.Medications\", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T01:00:02.9691450+02:00 0HNGRUIVGES84:00000009 [ERR] Error while admitting patient (a2588e81)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T01:00:02.9693497+02:00 0HNGRUIVGES84:00000009 [INF] Executing "ObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T01:00:02.9694791+02:00 0HNGRUIVGES84:00000009 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 142.9769ms (afa2e885)
2025-11-05T01:00:02.9695158+02:00 0HNGRUIVGES84:00000009 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T01:00:02.9698245+02:00 0HNGRUIVGES84:00000009 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 500 null "text/plain; charset=utf-8" 149.1773ms (74253ad3)
2025-11-05T01:05:04.2796764+02:00 0HNGRUIVGES85:00000003 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T01:05:04.2803568+02:00 0HNGRUIVGES85:00000003 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T01:05:04.2809086+02:00 0HNGRUIVGES85:00000003 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T01:05:04.3358050+02:00 0HNGRUIVGES85:00000003 [INF] Executed DbCommand ("10"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PatientMedications] ([MedicationId], [PatientId])
OUTPUT INSERTED.[PatientMedicationId]
VALUES (@p0, @p1);" (0723d8ff)
2025-11-05T01:05:04.3701521+02:00 0HNGRUIVGES85:00000003 [ERR] An exception occurred in the database while saving changes for context type '"E_Prescribing_API.Data.ApplicationDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_PatientMedications_Medications_MedicationId\". The conflict occurred in database \"E_Prescribing_API\", table \"dbo.Medications\", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:08eb5cb3-f1ec-43e5-912e-3856719ea523
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:08eb5cb3-f1ec-43e5-912e-3856719ea523
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T01:05:04.4510513+02:00 0HNGRUIVGES85:00000003 [ERR] Error while admitting patient (a2588e81)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:08eb5cb3-f1ec-43e5-912e-3856719ea523
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T01:05:04.4513055+02:00 0HNGRUIVGES85:00000003 [INF] Executing "ObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T01:05:04.4514319+02:00 0HNGRUIVGES85:00000003 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 170.4721ms (afa2e885)
2025-11-05T01:05:04.4514799+02:00 0HNGRUIVGES85:00000003 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T01:05:04.4516850+02:00 0HNGRUIVGES85:00000003 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 500 null "text/plain; charset=utf-8" 172.9998ms (74253ad3)
2025-11-05T01:06:51.7180142+02:00 0HNGRUIVGES85:00000005 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T01:06:51.7182923+02:00 0HNGRUIVGES85:00000005 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T01:06:51.7183786+02:00 0HNGRUIVGES85:00000005 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T01:06:51.7513192+02:00 0HNGRUIVGES85:00000005 [INF] Executed DbCommand ("28"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PatientMedications] ([MedicationId], [PatientId])
OUTPUT INSERTED.[PatientMedicationId]
VALUES (@p0, @p1);" (0723d8ff)
2025-11-05T01:06:51.7873560+02:00 0HNGRUIVGES85:00000005 [INF] Executing "OkObjectResult", writing value of type '"<>f__AnonymousType8`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]"'. (605b4265)
2025-11-05T01:06:51.7946868+02:00 0HNGRUIVGES85:00000005 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 76.2764ms (afa2e885)
2025-11-05T01:06:51.7947690+02:00 0HNGRUIVGES85:00000005 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T01:06:51.7949438+02:00 0HNGRUIVGES85:00000005 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 200 null "application/json; charset=utf-8" 77.0151ms (74253ad3)
2025-11-05T09:19:19.5415110+02:00  [INF] Executed DbCommand ("13"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T09:19:19.5876826+02:00  [INF] Executed DbCommand ("30"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T09:19:19.5901882+02:00  [INF] Executed DbCommand ("1"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T09:19:19.5909957+02:00  [INF] Executed DbCommand ("1"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T09:19:19.6213590+02:00  [INF] Executed DbCommand ("19"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];" (0723d8ff)
2025-11-05T09:19:19.6389540+02:00  [INF] Applying migration '"20251105071840_addprescrip"'. (0e2ac64d)
2025-11-05T09:19:19.7452910+02:00  [INF] Executed DbCommand ("7"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [Cities] DROP CONSTRAINT [FK_Cities_Provinces_ProvinceId];" (0723d8ff)
2025-11-05T09:19:19.7492124+02:00  [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [ContraIndications] DROP CONSTRAINT [FK_ContraIndications_ActiveIngredients_ActiveIngredientId];" (0723d8ff)
2025-11-05T09:19:19.7514225+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [ContraIndications] DROP CONSTRAINT [FK_ContraIndications_ConditionDiagnosis_ConditionDiagnosisId];" (0723d8ff)
2025-11-05T09:19:19.7554554+02:00  [INF] Executed DbCommand ("4"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [Facilities] DROP CONSTRAINT [FK_Facilities_FacilitiesTypes_FacilityTypeId];" (0723d8ff)
2025-11-05T09:19:19.7591772+02:00  [INF] Executed DbCommand ("4"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [MedicalStaffs] DROP CONSTRAINT [FK_MedicalStaffs_AspNetUsers_UserId];" (0723d8ff)
2025-11-05T09:19:19.7605981+02:00  [INF] Executed DbCommand ("1"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [MedicalStaffs] DROP CONSTRAINT [FK_MedicalStaffs_Facilities_FacilityId];" (0723d8ff)
2025-11-05T09:19:19.7627933+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [MedicationIngredients] DROP CONSTRAINT [FK_MedicationIngredients_ActiveIngredients_ActiveIngredientId];" (0723d8ff)
2025-11-05T09:19:19.7645321+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [MedicationIngredients] DROP CONSTRAINT [FK_MedicationIngredients_Medications_MedicationId];" (0723d8ff)
2025-11-05T09:19:19.9753311+02:00  [INF] Executed DbCommand ("5"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [Medications] DROP CONSTRAINT [FK_Medications_DosageForms_DosageFormId];" (0723d8ff)
2025-11-05T09:19:19.9787505+02:00  [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [PatientCondition] DROP CONSTRAINT [FK_PatientCondition_ConditionDiagnosis_ConditionId];" (0723d8ff)
2025-11-05T09:19:19.9818036+02:00  [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [PatientCondition] DROP CONSTRAINT [FK_PatientCondition_Patients_PatientId];" (0723d8ff)
2025-11-05T09:19:19.9844428+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [PatientMedications] DROP CONSTRAINT [FK_PatientMedications_Medications_MedicationId];" (0723d8ff)
2025-11-05T09:19:19.9863902+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [PatientMedications] DROP CONSTRAINT [FK_PatientMedications_Patients_PatientId];" (0723d8ff)
2025-11-05T09:19:19.9880101+02:00  [INF] Executed DbCommand ("1"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [Patients] DROP CONSTRAINT [FK_Patients_MedicalStaffs_MedicalSaffId];" (0723d8ff)
2025-11-05T09:19:19.9907718+02:00  [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [Patients] DROP CONSTRAINT [FK_Patients_Suburbs_SuburbId];" (0723d8ff)
2025-11-05T09:19:19.9927597+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [Suburbs] DROP CONSTRAINT [FK_Suburbs_Cities_CityId];" (0723d8ff)
2025-11-05T09:19:20.0007522+02:00  [INF] Executed DbCommand ("8"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_Suburbs_CityId] ON [Suburbs];" (0723d8ff)
2025-11-05T09:19:20.0047414+02:00  [INF] Executed DbCommand ("4"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_Patients_MedicalSaffId] ON [Patients];" (0723d8ff)
2025-11-05T09:19:21.1252941+02:00  [INF] Executed DbCommand ("4"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_Patients_SuburbId] ON [Patients];" (0723d8ff)
2025-11-05T09:19:21.1279857+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_PatientMedications_MedicationId] ON [PatientMedications];" (0723d8ff)
2025-11-05T09:19:21.1300260+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_PatientMedications_PatientId] ON [PatientMedications];" (0723d8ff)
2025-11-05T09:19:21.1323337+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_Medications_DosageFormId] ON [Medications];" (0723d8ff)
2025-11-05T09:19:21.1345947+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_MedicationIngredients_ActiveIngredientId] ON [MedicationIngredients];" (0723d8ff)
2025-11-05T09:19:21.1364644+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_MedicationIngredients_MedicationId] ON [MedicationIngredients];" (0723d8ff)
2025-11-05T09:19:21.1382384+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_MedicalStaffs_FacilityId] ON [MedicalStaffs];" (0723d8ff)
2025-11-05T09:19:21.1403696+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_MedicalStaffs_UserId] ON [MedicalStaffs];" (0723d8ff)
2025-11-05T09:19:21.1428781+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_Facilities_FacilityTypeId] ON [Facilities];" (0723d8ff)
2025-11-05T09:19:21.1450683+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_ContraIndications_ActiveIngredientId] ON [ContraIndications];" (0723d8ff)
2025-11-05T09:19:22.0357884+02:00  [INF] Executed DbCommand ("4"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_ContraIndications_ConditionDiagnosisId] ON [ContraIndications];" (0723d8ff)
2025-11-05T09:19:22.0387048+02:00  [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_Cities_ProvinceId] ON [Cities];" (0723d8ff)
2025-11-05T09:19:22.0504911+02:00  [INF] Executed DbCommand ("12"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [PatientCondition] DROP CONSTRAINT [PK_PatientCondition];" (0723d8ff)
2025-11-05T09:19:22.0526128+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""DROP INDEX [IX_PatientCondition_ConditionId] ON [PatientCondition];" (0723d8ff)
2025-11-05T09:19:22.4725030+02:00  [INF] Executed DbCommand ("420"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""EXEC sp_rename N'[PatientCondition]', N'PatientConditions';" (0723d8ff)
2025-11-05T09:19:22.4749520+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""EXEC sp_rename N'[PatientConditions].[IX_PatientCondition_PatientId]', N'IX_PatientConditions_PatientId', N'INDEX';" (0723d8ff)
2025-11-05T09:19:22.4792885+02:00  [INF] Executed DbCommand ("4"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [PatientConditions] ADD CONSTRAINT [PK_PatientConditions] PRIMARY KEY ([PatientConditionId]);" (0723d8ff)
2025-11-05T09:19:22.4831744+02:00  [INF] Executed DbCommand ("4"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE TABLE [PrescribedMedications] (
    [PrescribedMedicationId] int NOT NULL IDENTITY,
    [MedicationId] int NOT NULL,
    [PrescriptionId] int NOT NULL,
    [Quantity] int NOT NULL,
    [Instruction] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_PrescribedMedications] PRIMARY KEY ([PrescribedMedicationId])
);" (0723d8ff)
2025-11-05T09:19:22.4866777+02:00  [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE TABLE [Prescriptions] (
    [PrescriptionId] int NOT NULL IDENTITY,
    [Date] datetime2 NOT NULL,
    [Status] nvarchar(max) NOT NULL,
    [isUrgent] bit NOT NULL,
    [Note] nvarchar(max) NOT NULL,
    [PatientId] int NOT NULL,
    [PrescriberId] int NOT NULL,
    [DispenserId] int NULL,
    CONSTRAINT [PK_Prescriptions] PRIMARY KEY ([PrescriptionId]),
    CONSTRAINT [FK_Prescriptions_MedicalStaffs_DispenserId] FOREIGN KEY ([DispenserId]) REFERENCES [MedicalStaffs] ([StaffId]),
    CONSTRAINT [FK_Prescriptions_MedicalStaffs_PrescriberId] FOREIGN KEY ([PrescriberId]) REFERENCES [MedicalStaffs] ([StaffId]) ON DELETE CASCADE,
    CONSTRAINT [FK_Prescriptions_Patients_PatientId] FOREIGN KEY ([PatientId]) REFERENCES [Patients] ([PatientId]) ON DELETE CASCADE
);" (0723d8ff)
2025-11-05T09:19:23.0950743+02:00  [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE INDEX [IX_Prescriptions_DispenserId] ON [Prescriptions] ([DispenserId]);" (0723d8ff)
2025-11-05T09:19:23.1077051+02:00  [INF] Executed DbCommand ("12"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE INDEX [IX_Prescriptions_PatientId] ON [Prescriptions] ([PatientId]);" (0723d8ff)
2025-11-05T09:19:23.1128475+02:00  [INF] Executed DbCommand ("5"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE INDEX [IX_Prescriptions_PrescriberId] ON [Prescriptions] ([PrescriberId]);" (0723d8ff)
2025-11-05T09:19:23.1157220+02:00  [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""ALTER TABLE [PatientConditions] ADD CONSTRAINT [FK_PatientConditions_Patients_PatientId] FOREIGN KEY ([PatientId]) REFERENCES [Patients] ([PatientId]) ON DELETE CASCADE;" (0723d8ff)
2025-11-05T09:19:23.1178839+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251105071840_addprescrip', N'8.0.0');" (0723d8ff)
2025-11-05T11:21:41.9301994+02:00  [INF] User profile is available. Using '"C:\Users\ThatoTs\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest. (7ac5e29c)
2025-11-05T11:21:42.2349384+02:00  [INF] Now listening on: "https://localhost:7150" (d826f4b8)
2025-11-05T11:21:42.2374581+02:00  [INF] Now listening on: "http://localhost:5031" (d826f4b8)
2025-11-05T11:21:42.3109674+02:00  [INF] Application started. Press Ctrl+C to shut down. (dcaefe54)
2025-11-05T11:21:42.3143528+02:00  [INF] Hosting environment: "Development" (bc5a1a4e)
2025-11-05T11:21:42.3169162+02:00  [INF] Content root path: "D:\HomeSpace\E_Prescribing_API\E_Prescribing_API" (cc26f24e)
2025-11-05T11:21:44.1681638+02:00 0HNGS9ITP7IOB:00000003 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - null null (d509f86a)
2025-11-05T11:21:44.5234581+02:00 0HNGS9ITP7IOB:00000003 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - 301 0 null 365.1994ms (74253ad3)
2025-11-05T11:21:44.5678177+02:00 0HNGS9ITP7IOB:00000005 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - null null (d509f86a)
2025-11-05T11:21:44.7516780+02:00 0HNGS9ITP7IOB:00000005 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - 200 null "text/html;charset=utf-8" 184.1309ms (74253ad3)
2025-11-05T11:21:44.8811761+02:00 0HNGS9ITP7IOB:00000007 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - null null (d509f86a)
2025-11-05T11:21:44.8840472+02:00 0HNGS9ITP7IOB:00000009 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - null null (d509f86a)
2025-11-05T11:21:44.8886921+02:00 0HNGS9ITP7IOB:0000000B [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - null null (d509f86a)
2025-11-05T11:21:44.9128517+02:00 0HNGS9ITP7IOB:00000009 [INF] Sending file. Request path: '"/swagger-ui.css"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T11:21:44.9130807+02:00 0HNGS9ITP7IOB:00000009 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - 499 152034 "text/css" 29.1169ms (74253ad3)
2025-11-05T11:21:45.0117116+02:00 0HNGS9ITP7IOB:0000000B [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - 200 null "text/javascript; charset=UTF-8" 123.2611ms (74253ad3)
2025-11-05T11:21:46.7527415+02:00 0HNGS9ITP7IOB:00000007 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - 200 13770 "application/javascript; charset=utf-8" 1872.4342ms (74253ad3)
2025-11-05T11:21:48.6042650+02:00 0HNGS9ITP7IOB:0000000D [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - null null (d509f86a)
2025-11-05T11:21:48.8153075+02:00 0HNGS9ITP7IOB:0000000D [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - 200 null "application/json;charset=utf-8" 211.3782ms (74253ad3)
2025-11-05T11:27:12.5572757+02:00  [INF] Executed DbCommand ("11"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T11:27:12.5773791+02:00  [INF] Executed DbCommand ("11"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T11:27:12.5792116+02:00  [INF] Executed DbCommand ("1"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T11:27:12.5800061+02:00  [INF] Executed DbCommand ("1"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T11:27:12.5990987+02:00  [INF] Executed DbCommand ("11"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];" (0723d8ff)
2025-11-05T11:27:12.6086232+02:00  [INF] Applying migration '"20251105092659_AllegiesTable"'. (0e2ac64d)
2025-11-05T11:27:13.0803209+02:00  [INF] Executed DbCommand ("431"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""EXEC sp_rename N'[Prescriptions].[isUrgent]', N'IsUrgent', N'COLUMN';" (0723d8ff)
2025-11-05T11:27:13.1135655+02:00  [ERR] Failed executing DbCommand ("30"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE TABLE [MedicationInteractions] (
    [InteractionId] int NOT NULL IDENTITY,
    [ActiveIngredient1Id] int NOT NULL,
    [ActiveIngredient2Id] int NOT NULL,
    [Description] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_MedicationInteractions] PRIMARY KEY ([InteractionId]),
    CONSTRAINT [FK_MedicationInteractions_ActiveIngredients_ActiveIngredient1Id] FOREIGN KEY ([ActiveIngredient1Id]) REFERENCES [ActiveIngredients] ([IngredientId]) ON DELETE CASCADE,
    CONSTRAINT [FK_MedicationInteractions_ActiveIngredients_ActiveIngredient2Id] FOREIGN KEY ([ActiveIngredient2Id]) REFERENCES [ActiveIngredients] ([IngredientId]) ON DELETE CASCADE
);" (627a98df)
2025-11-05T11:28:52.9158196+02:00  [INF] Executed DbCommand ("14"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T11:28:52.9387378+02:00  [INF] Executed DbCommand ("11"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T11:28:52.9423563+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T11:28:52.9433294+02:00  [INF] Executed DbCommand ("1"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T11:28:52.9584574+02:00  [INF] Executed DbCommand ("4"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];" (0723d8ff)
2025-11-05T11:28:52.9741660+02:00  [INF] Applying migration '"20251105092659_AllegiesTable"'. (0e2ac64d)
2025-11-05T11:28:53.3970411+02:00  [INF] Executed DbCommand ("364"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""EXEC sp_rename N'[Prescriptions].[isUrgent]', N'IsUrgent', N'COLUMN';" (0723d8ff)
2025-11-05T11:28:53.4128663+02:00  [ERR] Failed executing DbCommand ("10"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE TABLE [MedicationInteractions] (
    [InteractionId] int NOT NULL IDENTITY,
    [ActiveIngredient1Id] int NOT NULL,
    [ActiveIngredient2Id] int NOT NULL,
    [Description] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_MedicationInteractions] PRIMARY KEY ([InteractionId]),
    CONSTRAINT [FK_MedicationInteractions_ActiveIngredients_ActiveIngredient1Id] FOREIGN KEY ([ActiveIngredient1Id]) REFERENCES [ActiveIngredients] ([IngredientId]) ON DELETE CASCADE,
    CONSTRAINT [FK_MedicationInteractions_ActiveIngredients_ActiveIngredient2Id] FOREIGN KEY ([ActiveIngredient2Id]) REFERENCES [ActiveIngredients] ([IngredientId]) ON DELETE CASCADE
);" (627a98df)
2025-11-05T11:29:18.3546584+02:00  [INF] Executed DbCommand ("19"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T11:29:18.3787949+02:00  [INF] Executed DbCommand ("11"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T11:29:18.3922016+02:00  [INF] Executed DbCommand ("9"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];" (0723d8ff)
2025-11-05T11:29:46.5319582+02:00  [INF] Executed DbCommand ("15"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T11:29:46.5615694+02:00  [INF] Executed DbCommand ("15"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T11:29:46.5647107+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T11:29:46.5670935+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T11:29:46.5837353+02:00  [INF] Executed DbCommand ("5"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];" (0723d8ff)
2025-11-05T11:29:46.5991996+02:00  [INF] Applying migration '"20251105092933_addInd"'. (0e2ac64d)
2025-11-05T11:29:47.3043409+02:00  [INF] Executed DbCommand ("642"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""EXEC sp_rename N'[Prescriptions].[isUrgent]', N'IsUrgent', N'COLUMN';" (0723d8ff)
2025-11-05T11:29:47.3183892+02:00  [ERR] Failed executing DbCommand ("9"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE TABLE [MedicationInteractions] (
    [InteractionId] int NOT NULL IDENTITY,
    [ActiveIngredient1Id] int NOT NULL,
    [ActiveIngredient2Id] int NOT NULL,
    [Description] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_MedicationInteractions] PRIMARY KEY ([InteractionId]),
    CONSTRAINT [FK_MedicationInteractions_ActiveIngredients_ActiveIngredient1Id] FOREIGN KEY ([ActiveIngredient1Id]) REFERENCES [ActiveIngredients] ([IngredientId]) ON DELETE CASCADE,
    CONSTRAINT [FK_MedicationInteractions_ActiveIngredients_ActiveIngredient2Id] FOREIGN KEY ([ActiveIngredient2Id]) REFERENCES [ActiveIngredients] ([IngredientId]) ON DELETE CASCADE
);" (627a98df)
2025-11-05T11:33:55.3325913+02:00  [INF] Executed DbCommand ("12"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T11:33:55.3574286+02:00  [INF] Executed DbCommand ("12"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T11:33:55.3598055+02:00  [INF] Executed DbCommand ("1"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT 1" (0723d8ff)
2025-11-05T11:33:55.3611355+02:00  [INF] Executed DbCommand ("1"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT OBJECT_ID(N'[__EFMigrationsHistory]');" (0723d8ff)
2025-11-05T11:33:55.3776705+02:00  [INF] Executed DbCommand ("7"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];" (0723d8ff)
2025-11-05T11:33:55.3888864+02:00  [INF] Applying migration '"20251105092933_addInd"'. (0e2ac64d)
2025-11-05T11:33:55.8877749+02:00  [INF] Executed DbCommand ("458"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""EXEC sp_rename N'[Prescriptions].[isUrgent]', N'IsUrgent', N'COLUMN';" (0723d8ff)
2025-11-05T11:33:55.8947639+02:00  [INF] Executed DbCommand ("6"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE TABLE [MedicationInteractions] (
    [InteractionId] int NOT NULL IDENTITY,
    [ActiveIngredient1Id] int NOT NULL,
    [ActiveIngredient2Id] int NOT NULL,
    [Description] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_MedicationInteractions] PRIMARY KEY ([InteractionId]),
    CONSTRAINT [FK_MedicationInteractions_ActiveIngredients_ActiveIngredient1Id] FOREIGN KEY ([ActiveIngredient1Id]) REFERENCES [ActiveIngredients] ([IngredientId]) ON DELETE CASCADE,
    CONSTRAINT [FK_MedicationInteractions_ActiveIngredients_ActiveIngredient2Id] FOREIGN KEY ([ActiveIngredient2Id]) REFERENCES [ActiveIngredients] ([IngredientId]) ON DELETE NO ACTION
);" (0723d8ff)
2025-11-05T11:33:55.9060615+02:00  [INF] Executed DbCommand ("11"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE TABLE [PatientAllergies] (
    [AllergyId] int NOT NULL IDENTITY,
    [PatientId] int NOT NULL,
    [ActiveIngredientId] int NOT NULL,
    CONSTRAINT [PK_PatientAllergies] PRIMARY KEY ([AllergyId]),
    CONSTRAINT [FK_PatientAllergies_ActiveIngredients_ActiveIngredientId] FOREIGN KEY ([ActiveIngredientId]) REFERENCES [ActiveIngredients] ([IngredientId]) ON DELETE CASCADE,
    CONSTRAINT [FK_PatientAllergies_Patients_PatientId] FOREIGN KEY ([PatientId]) REFERENCES [Patients] ([PatientId]) ON DELETE CASCADE
);" (0723d8ff)
2025-11-05T11:33:55.9115577+02:00  [INF] Executed DbCommand ("5"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE INDEX [IX_MedicationInteractions_ActiveIngredient1Id] ON [MedicationInteractions] ([ActiveIngredient1Id]);" (0723d8ff)
2025-11-05T11:33:55.9152553+02:00  [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE INDEX [IX_MedicationInteractions_ActiveIngredient2Id] ON [MedicationInteractions] ([ActiveIngredient2Id]);" (0723d8ff)
2025-11-05T11:33:55.9857257+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE INDEX [IX_PatientAllergies_ActiveIngredientId] ON [PatientAllergies] ([ActiveIngredientId]);" (0723d8ff)
2025-11-05T11:33:55.9879849+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""CREATE INDEX [IX_PatientAllergies_PatientId] ON [PatientAllergies] ([PatientId]);" (0723d8ff)
2025-11-05T11:33:55.9906049+02:00  [INF] Executed DbCommand ("2"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20251105092933_addInd', N'8.0.0');" (0723d8ff)
2025-11-05T11:34:14.0903511+02:00  [INF] User profile is available. Using '"C:\Users\ThatoTs\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest. (7ac5e29c)
2025-11-05T11:34:14.3297538+02:00  [INF] Now listening on: "https://localhost:7150" (d826f4b8)
2025-11-05T11:34:14.3315691+02:00  [INF] Now listening on: "http://localhost:5031" (d826f4b8)
2025-11-05T11:34:14.3713093+02:00  [INF] Application started. Press Ctrl+C to shut down. (dcaefe54)
2025-11-05T11:34:14.3744653+02:00  [INF] Hosting environment: "Development" (bc5a1a4e)
2025-11-05T11:34:14.3762823+02:00  [INF] Content root path: "D:\HomeSpace\E_Prescribing_API\E_Prescribing_API" (cc26f24e)
2025-11-05T11:34:15.6056588+02:00 0HNGS9PTUQU18:00000003 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - null null (d509f86a)
2025-11-05T11:34:15.8088786+02:00 0HNGS9PTUQU18:00000003 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - 301 0 null 210.2277ms (74253ad3)
2025-11-05T11:34:15.8427545+02:00 0HNGS9PTUQU18:00000005 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - null null (d509f86a)
2025-11-05T11:34:15.9462189+02:00 0HNGS9PTUQU18:00000005 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - 200 null "text/html;charset=utf-8" 103.7069ms (74253ad3)
2025-11-05T11:34:16.0660511+02:00 0HNGS9PTUQU18:00000007 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - null null (d509f86a)
2025-11-05T11:34:16.0705230+02:00 0HNGS9PTUQU18:00000009 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - null null (d509f86a)
2025-11-05T11:34:16.0719688+02:00 0HNGS9PTUQU18:0000000B [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - null null (d509f86a)
2025-11-05T11:34:16.0730642+02:00 0HNGS9PTUQU18:00000007 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - 200 13770 "application/javascript; charset=utf-8" 7.514ms (74253ad3)
2025-11-05T11:34:16.0911857+02:00 0HNGS9PTUQU18:00000009 [INF] Sending file. Request path: '"/swagger-ui.css"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T11:34:16.0914256+02:00 0HNGS9PTUQU18:00000009 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - 499 152034 "text/css" 20.9924ms (74253ad3)
2025-11-05T11:34:16.1359084+02:00 0HNGS9PTUQU18:0000000B [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - 200 null "text/javascript; charset=UTF-8" 64.1917ms (74253ad3)
2025-11-05T11:34:16.2382158+02:00 0HNGS9PTUQU18:0000000D [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-16x16.png""" - null null (d509f86a)
2025-11-05T11:34:16.2411244+02:00 0HNGS9PTUQU18:0000000D [INF] Sending file. Request path: '"/favicon-16x16.png"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T11:34:16.2413526+02:00 0HNGS9PTUQU18:0000000D [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-16x16.png""" - 499 665 "image/png" 3.4372ms (74253ad3)
2025-11-05T11:34:16.3507783+02:00 0HNGS9PTUQU18:0000000F [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - null null (d509f86a)
2025-11-05T11:34:16.6491566+02:00 0HNGS9PTUQU18:0000000F [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - 200 null "application/json;charset=utf-8" 298.4557ms (74253ad3)
2025-11-05T11:38:20.7841587+02:00 0HNGS9PTUQU19:00000003 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1495 (d509f86a)
2025-11-05T11:38:20.7905922+02:00 0HNGS9PTUQU19:00000003 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:38:20.8182874+02:00 0HNGS9PTUQU19:00000003 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:38:21.1057940+02:00 0HNGS9PTUQU19:00000003 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 282.8047ms (afa2e885)
2025-11-05T11:38:21.1070692+02:00 0HNGS9PTUQU19:00000003 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:38:21.1618864+02:00 0HNGS9PTUQU19:00000003 [ERR] An unhandled exception has occurred while executing the request. (48a46595)
System.InvalidOperationException: Unable to resolve service for type 'E_Prescribing_API.Data.Services.Alerts' while attempting to activate 'E_Prescribing_API.Controllers.PrescriptionController'.
   at Microsoft.Extensions.DependencyInjection.ActivatorUtilities.ThrowHelperUnableToResolveService(Type type, Type requiredBy)
   at lambda_method9(Closure, IServiceProvider, Object[])
   at Microsoft.AspNetCore.Mvc.Controllers.ControllerFactoryProvider.<>c__DisplayClass6_0.<CreateControllerFactory>g__CreateController|0(ControllerContext controllerContext)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-11-05T11:38:21.1688527+02:00 0HNGS9PTUQU19:00000003 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 500 null "text/plain; charset=utf-8" 384.7495ms (74253ad3)
2025-11-05T11:39:38.2251756+02:00  [INF] User profile is available. Using '"C:\Users\ThatoTs\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest. (7ac5e29c)
2025-11-05T11:39:38.4976017+02:00  [INF] Now listening on: "https://localhost:7150" (d826f4b8)
2025-11-05T11:39:38.4998999+02:00  [INF] Now listening on: "http://localhost:5031" (d826f4b8)
2025-11-05T11:39:38.5973122+02:00  [INF] Application started. Press Ctrl+C to shut down. (dcaefe54)
2025-11-05T11:39:38.5996172+02:00  [INF] Hosting environment: "Development" (bc5a1a4e)
2025-11-05T11:39:38.6017123+02:00  [INF] Content root path: "D:\HomeSpace\E_Prescribing_API\E_Prescribing_API" (cc26f24e)
2025-11-05T11:39:40.4635922+02:00 0HNGS9SUJ71GA:00000003 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - null null (d509f86a)
2025-11-05T11:39:40.7373908+02:00 0HNGS9SUJ71GA:00000003 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - 301 0 null 287.5081ms (74253ad3)
2025-11-05T11:39:40.7808891+02:00 0HNGS9SUJ71GA:00000005 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - null null (d509f86a)
2025-11-05T11:39:40.9406660+02:00 0HNGS9SUJ71GA:00000005 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - 200 null "text/html;charset=utf-8" 159.9336ms (74253ad3)
2025-11-05T11:39:41.3893887+02:00 0HNGS9SUJ71GA:00000007 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - null null (d509f86a)
2025-11-05T11:39:41.3937274+02:00 0HNGS9SUJ71GA:00000009 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - null null (d509f86a)
2025-11-05T11:39:41.3998935+02:00 0HNGS9SUJ71GA:0000000B [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - null null (d509f86a)
2025-11-05T11:39:41.4010841+02:00 0HNGS9SUJ71GA:00000007 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - 200 13770 "application/javascript; charset=utf-8" 11.7676ms (74253ad3)
2025-11-05T11:39:41.4257701+02:00 0HNGS9SUJ71GA:00000009 [INF] Sending file. Request path: '"/swagger-ui.css"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T11:39:41.4260507+02:00 0HNGS9SUJ71GA:00000009 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - 499 152034 "text/css" 32.3987ms (74253ad3)
2025-11-05T11:39:42.8395388+02:00 0HNGS9SUJ71GA:0000000B [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - 200 null "text/javascript; charset=UTF-8" 1439.6792ms (74253ad3)
2025-11-05T11:39:42.8821160+02:00 0HNGS9SUJ71GA:0000000D [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-16x16.png""" - null null (d509f86a)
2025-11-05T11:39:42.8874025+02:00 0HNGS9SUJ71GA:0000000D [INF] Sending file. Request path: '"/favicon-16x16.png"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T11:39:42.8876176+02:00 0HNGS9SUJ71GA:0000000D [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-16x16.png""" - 499 665 "image/png" 6.5082ms (74253ad3)
2025-11-05T11:39:43.2875059+02:00 0HNGS9SUJ71GA:0000000F [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - null null (d509f86a)
2025-11-05T11:39:43.5101581+02:00 0HNGS9SUJ71GA:0000000F [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - 200 null "application/json;charset=utf-8" 223.6261ms (74253ad3)
2025-11-05T11:40:07.5155203+02:00 0HNGS9SUJ71GA:00000011 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1495 (d509f86a)
2025-11-05T11:40:07.5201011+02:00 0HNGS9SUJ71GA:00000011 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:40:07.5496259+02:00 0HNGS9SUJ71GA:00000011 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:40:09.6573717+02:00 0HNGS9SUJ71GA:00000011 [INF] Executed DbCommand ("64"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [m].[StaffId], [m].[ContactNumber], [m].[FacilityId], [m].[FullName], [m].[Name], [m].[RegistrationNumber], [m].[Surname], [m].[UserId]
FROM [MedicalStaffs] AS [m]
WHERE 0 = 1" (0723d8ff)
2025-11-05T11:40:09.6865299+02:00 0HNGS9SUJ71GA:00000011 [INF] Executing "UnauthorizedObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T11:40:09.6913602+02:00 0HNGS9SUJ71GA:00000011 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 2138.3503ms (afa2e885)
2025-11-05T11:40:09.6917895+02:00 0HNGS9SUJ71GA:00000011 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:40:09.6982440+02:00 0HNGS9SUJ71GA:00000011 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 401 null "text/plain; charset=utf-8" 2183.2367ms (74253ad3)
2025-11-05T11:42:44.2439408+02:00 0HNGS9SUJ71GA:00000013 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1495 (d509f86a)
2025-11-05T11:42:44.2492603+02:00 0HNGS9SUJ71GA:00000013 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:42:44.2498721+02:00 0HNGS9SUJ71GA:00000013 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:42:44.2875997+02:00 0HNGS9SUJ71GA:00000013 [INF] Executed DbCommand ("6"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [m].[StaffId], [m].[ContactNumber], [m].[FacilityId], [m].[FullName], [m].[Name], [m].[RegistrationNumber], [m].[Surname], [m].[UserId]
FROM [MedicalStaffs] AS [m]
WHERE 0 = 1" (0723d8ff)
2025-11-05T11:42:44.2886482+02:00 0HNGS9SUJ71GA:00000013 [INF] Executing "UnauthorizedObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T11:42:44.2888295+02:00 0HNGS9SUJ71GA:00000013 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 38.8486ms (afa2e885)
2025-11-05T11:42:44.2888839+02:00 0HNGS9SUJ71GA:00000013 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:42:44.2891112+02:00 0HNGS9SUJ71GA:00000013 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 401 null "text/plain; charset=utf-8" 45.2811ms (74253ad3)
2025-11-05T11:45:40.8866665+02:00 0HNGS9SUJ71GB:00000003 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1496 (d509f86a)
2025-11-05T11:45:40.8880009+02:00 0HNGS9SUJ71GB:00000003 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:45:40.8881603+02:00 0HNGS9SUJ71GB:00000003 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:45:40.9686175+02:00 0HNGS9SUJ71GB:00000003 [INF] Executed DbCommand ("4"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [m].[StaffId], [m].[ContactNumber], [m].[FacilityId], [m].[FullName], [m].[Name], [m].[RegistrationNumber], [m].[Surname], [m].[UserId]
FROM [MedicalStaffs] AS [m]
WHERE 0 = 1" (0723d8ff)
2025-11-05T11:45:40.9692100+02:00 0HNGS9SUJ71GB:00000003 [INF] Executing "UnauthorizedObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T11:45:40.9693946+02:00 0HNGS9SUJ71GB:00000003 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 81.1635ms (afa2e885)
2025-11-05T11:45:40.9694878+02:00 0HNGS9SUJ71GB:00000003 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:45:40.9699156+02:00 0HNGS9SUJ71GB:00000003 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 401 null "text/plain; charset=utf-8" 83.865ms (74253ad3)
2025-11-05T11:46:48.3264673+02:00 0HNGS9SUJ71GB:00000005 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1497 (d509f86a)
2025-11-05T11:46:48.3268637+02:00 0HNGS9SUJ71GB:00000005 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:46:48.3269646+02:00 0HNGS9SUJ71GB:00000005 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:46:48.3340059+02:00 0HNGS9SUJ71GB:00000005 [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [m].[StaffId], [m].[ContactNumber], [m].[FacilityId], [m].[FullName], [m].[Name], [m].[RegistrationNumber], [m].[Surname], [m].[UserId]
FROM [MedicalStaffs] AS [m]
WHERE 0 = 1" (0723d8ff)
2025-11-05T11:46:48.3345686+02:00 0HNGS9SUJ71GB:00000005 [INF] Executing "UnauthorizedObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T11:46:48.3347448+02:00 0HNGS9SUJ71GB:00000005 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 7.734ms (afa2e885)
2025-11-05T11:46:48.3348172+02:00 0HNGS9SUJ71GB:00000005 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:46:48.3349927+02:00 0HNGS9SUJ71GB:00000005 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 401 null "text/plain; charset=utf-8" 9.0928ms (74253ad3)
2025-11-05T11:48:00.6517513+02:00 0HNGS9SUJ71GB:00000007 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 255 (d509f86a)
2025-11-05T11:48:00.6520661+02:00 0HNGS9SUJ71GB:00000007 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:48:00.6523056+02:00 0HNGS9SUJ71GB:00000007 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:48:00.6566507+02:00 0HNGS9SUJ71GB:00000007 [INF] Executing "BadRequestObjectResult", writing value of type '"Microsoft.AspNetCore.Mvc.ValidationProblemDetails"'. (605b4265)
2025-11-05T11:48:00.6833699+02:00 0HNGS9SUJ71GB:00000007 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 30.9873ms (afa2e885)
2025-11-05T11:48:00.6834330+02:00 0HNGS9SUJ71GB:00000007 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:48:00.6837037+02:00 0HNGS9SUJ71GB:00000007 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 400 null "application/problem+json; charset=utf-8" 31.8726ms (74253ad3)
2025-11-05T11:51:03.0342185+02:00 0HNGS9SUJ71GC:00000003 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1492 (d509f86a)
2025-11-05T11:51:03.0347039+02:00 0HNGS9SUJ71GC:00000003 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:51:03.0348247+02:00 0HNGS9SUJ71GC:00000003 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:51:03.0464891+02:00 0HNGS9SUJ71GC:00000003 [INF] Executing "BadRequestObjectResult", writing value of type '"Microsoft.AspNetCore.Mvc.ValidationProblemDetails"'. (605b4265)
2025-11-05T11:51:03.0469111+02:00 0HNGS9SUJ71GC:00000003 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 12.0526ms (afa2e885)
2025-11-05T11:51:03.0469587+02:00 0HNGS9SUJ71GC:00000003 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:51:03.0470569+02:00 0HNGS9SUJ71GC:00000003 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 400 null "application/problem+json; charset=utf-8" 13.7634ms (74253ad3)
2025-11-05T11:52:42.5809478+02:00 0HNGS9SUJ71GC:00000005 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1509 (d509f86a)
2025-11-05T11:52:42.5812718+02:00 0HNGS9SUJ71GC:00000005 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:52:42.5817353+02:00 0HNGS9SUJ71GC:00000005 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:52:42.5908760+02:00 0HNGS9SUJ71GC:00000005 [INF] Executing "BadRequestObjectResult", writing value of type '"Microsoft.AspNetCore.Mvc.ValidationProblemDetails"'. (605b4265)
2025-11-05T11:52:42.5910880+02:00 0HNGS9SUJ71GC:00000005 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 9.3264ms (afa2e885)
2025-11-05T11:52:42.5911166+02:00 0HNGS9SUJ71GC:00000005 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:52:42.5911813+02:00 0HNGS9SUJ71GC:00000005 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 400 null "application/problem+json; charset=utf-8" 10.3287ms (74253ad3)
2025-11-05T11:53:03.9775401+02:00 0HNGS9SUJ71GC:00000007 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1495 (d509f86a)
2025-11-05T11:53:03.9780046+02:00 0HNGS9SUJ71GC:00000007 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:53:03.9781081+02:00 0HNGS9SUJ71GC:00000007 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:53:03.9806866+02:00 0HNGS9SUJ71GC:00000007 [INF] Executing "BadRequestObjectResult", writing value of type '"Microsoft.AspNetCore.Mvc.ValidationProblemDetails"'. (605b4265)
2025-11-05T11:53:03.9809423+02:00 0HNGS9SUJ71GC:00000007 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 2.7854ms (afa2e885)
2025-11-05T11:53:03.9809801+02:00 0HNGS9SUJ71GC:00000007 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:53:03.9810707+02:00 0HNGS9SUJ71GC:00000007 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 400 null "application/problem+json; charset=utf-8" 3.9246ms (74253ad3)
2025-11-05T11:53:30.1118974+02:00 0HNGS9SUJ71GC:00000009 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1497 (d509f86a)
2025-11-05T11:53:30.1121627+02:00 0HNGS9SUJ71GC:00000009 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:53:30.1122493+02:00 0HNGS9SUJ71GC:00000009 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:53:30.1354636+02:00 0HNGS9SUJ71GC:00000009 [INF] Executed DbCommand ("3"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [m].[StaffId], [m].[ContactNumber], [m].[FacilityId], [m].[FullName], [m].[Name], [m].[RegistrationNumber], [m].[Surname], [m].[UserId]
FROM [MedicalStaffs] AS [m]
WHERE 0 = 1" (0723d8ff)
2025-11-05T11:53:30.1357535+02:00 0HNGS9SUJ71GC:00000009 [INF] Executing "UnauthorizedObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T11:53:30.1358421+02:00 0HNGS9SUJ71GC:00000009 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 23.5587ms (afa2e885)
2025-11-05T11:53:30.1358607+02:00 0HNGS9SUJ71GC:00000009 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:53:30.1359757+02:00 0HNGS9SUJ71GC:00000009 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 401 null "text/plain; charset=utf-8" 24.4484ms (74253ad3)
2025-11-05T11:56:05.4892489+02:00  [INF] User profile is available. Using '"C:\Users\ThatoTs\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest. (7ac5e29c)
2025-11-05T11:56:05.7389633+02:00  [INF] Now listening on: "https://localhost:7150" (d826f4b8)
2025-11-05T11:56:05.7409117+02:00  [INF] Now listening on: "http://localhost:5031" (d826f4b8)
2025-11-05T11:56:05.7869522+02:00  [INF] Application started. Press Ctrl+C to shut down. (dcaefe54)
2025-11-05T11:56:05.7891518+02:00  [INF] Hosting environment: "Development" (bc5a1a4e)
2025-11-05T11:56:05.7909799+02:00  [INF] Content root path: "D:\HomeSpace\E_Prescribing_API\E_Prescribing_API" (cc26f24e)
2025-11-05T11:56:06.7953997+02:00 0HNGSA64NS4UB:00000003 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - null null (d509f86a)
2025-11-05T11:56:07.0056369+02:00 0HNGSA64NS4UB:00000003 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - 301 0 null 216.9641ms (74253ad3)
2025-11-05T11:56:07.0450317+02:00 0HNGSA64NS4UB:00000005 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - null null (d509f86a)
2025-11-05T11:56:07.1293533+02:00 0HNGSA64NS4UB:00000005 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - 200 null "text/html;charset=utf-8" 84.4531ms (74253ad3)
2025-11-05T11:56:07.1789621+02:00 0HNGSA64NS4UB:00000007 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - null null (d509f86a)
2025-11-05T11:56:07.1839685+02:00 0HNGSA64NS4UB:00000007 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - 200 13770 "application/javascript; charset=utf-8" 5.28ms (74253ad3)
2025-11-05T11:56:07.1877323+02:00 0HNGSA64NS4UB:00000009 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - null null (d509f86a)
2025-11-05T11:56:07.1917215+02:00 0HNGSA64NS4UB:0000000B [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - null null (d509f86a)
2025-11-05T11:56:07.2058851+02:00 0HNGSA64NS4UB:00000009 [INF] Sending file. Request path: '"/swagger-ui.css"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T11:56:07.2060484+02:00 0HNGSA64NS4UB:00000009 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - 499 152034 "text/css" 18.3555ms (74253ad3)
2025-11-05T11:56:07.2376513+02:00 0HNGSA64NS4UB:0000000B [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - 200 null "text/javascript; charset=UTF-8" 46.1285ms (74253ad3)
2025-11-05T11:56:07.3466889+02:00 0HNGSA64NS4UB:0000000D [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - null null (d509f86a)
2025-11-05T11:56:07.4433100+02:00 0HNGSA64NS4UB:0000000D [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - 200 null "application/json;charset=utf-8" 96.6501ms (74253ad3)
2025-11-05T11:56:18.4067650+02:00 0HNGSA64NS4UB:0000000F [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1497 (d509f86a)
2025-11-05T11:56:18.4115745+02:00 0HNGSA64NS4UB:0000000F [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T11:56:18.4362686+02:00 0HNGSA64NS4UB:0000000F [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T11:56:19.9827960+02:00 0HNGSA64NS4UB:0000000F [INF] Executed DbCommand ("46"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [m].[StaffId], [m].[ContactNumber], [m].[FacilityId], [m].[FullName], [m].[Name], [m].[RegistrationNumber], [m].[Surname], [m].[UserId]
FROM [MedicalStaffs] AS [m]
WHERE [m].[UserId] = 10" (0723d8ff)
2025-11-05T11:56:20.2880594+02:00 0HNGSA64NS4UB:0000000F [INF] Executed DbCommand ("107"ms) [Parameters=["@__8__locals1_patientId_0='?' (DbType = Int32), @__medicationIdsList_1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SELECT [t].[IngredientName], [t].[MedicationName]
FROM (
    SELECT DISTINCT [a].[Name] AS [IngredientName], [m0].[Name] AS [MedicationName]
    FROM [PatientAllergies] AS [p]
    INNER JOIN [MedicationIngredients] AS [m] ON [p].[ActiveIngredientId] = [m].[ActiveIngredientId]
    INNER JOIN [ActiveIngredients] AS [a] ON [m].[ActiveIngredientId] = [a].[IngredientId]
    INNER JOIN [Medications] AS [m0] ON [m].[MedicationId] = [m0].[MedicationId]
    WHERE [p].[PatientId] = @__8__locals1_patientId_0 AND [m].[MedicationId] IN (
        SELECT [m1].[value]
        FROM OPENJSON(@__medicationIdsList_1) WITH ([value] int '$') AS [m1]
    )
) AS [t]" (0723d8ff)
2025-11-05T11:56:20.3385806+02:00 0HNGSA64NS4UB:0000000F [INF] Executed DbCommand ("31"ms) [Parameters=["@__patientId_0='?' (DbType = Int32), @__medicationIdsList_1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SELECT [t].[Name]
FROM (
    SELECT DISTINCT [a].[Name]
    FROM [ContraIndications] AS [c]
    INNER JOIN [ActiveIngredients] AS [a] ON [c].[ActiveIngredientId] = [a].[IngredientId]
    INNER JOIN [MedicationIngredients] AS [m] ON [a].[IngredientId] = [m].[ActiveIngredientId]
    INNER JOIN [PatientConditions] AS [p] ON @__patientId_0 = [p].[PatientId] AND [c].[ConditionDiagnosisId] = [p].[ConditionId]
    WHERE [m].[MedicationId] IN (
        SELECT [m0].[value]
        FROM OPENJSON(@__medicationIdsList_1) WITH ([value] int '$') AS [m0]
    )
) AS [t]" (0723d8ff)
2025-11-05T11:56:20.3967432+02:00 0HNGSA64NS4UB:0000000F [INF] Executed DbCommand ("37"ms) [Parameters=["@__newMedicationIdsList_1='?' (Size = 4000), @__8__locals1_patientId_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT DISTINCT [m1].[Description]
FROM [PatientMedications] AS [p]
INNER JOIN [MedicationIngredients] AS [m] ON [p].[MedicationId] = [m].[MedicationId]
INNER JOIN (
    SELECT [m0].[ActiveIngredientId]
    FROM [MedicationIngredients] AS [m0]
    WHERE [m0].[MedicationId] IN (
        SELECT [n].[value]
        FROM OPENJSON(@__newMedicationIdsList_1) WITH ([value] int '$') AS [n]
    )
) AS [t] ON [m].[ActiveIngredientId] <> [t].[ActiveIngredientId]
CROSS JOIN [MedicationInteractions] AS [m1]
WHERE [p].[PatientId] = @__8__locals1_patientId_0 AND (([m1].[ActiveIngredient1Id] = [m].[ActiveIngredientId] AND [m1].[ActiveIngredient2Id] = [t].[ActiveIngredientId]) OR ([m1].[ActiveIngredient1Id] = [t].[ActiveIngredientId] AND [m1].[ActiveIngredient2Id] = [m].[ActiveIngredientId]))" (0723d8ff)
2025-11-05T11:56:20.5399986+02:00 0HNGSA64NS4UB:0000000F [INF] Executed DbCommand ("10"ms) [Parameters=["@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Prescriptions] ([Date], [DispenserId], [IsUrgent], [Note], [PatientId], [PrescriberId], [Status])
OUTPUT INSERTED.[PrescriptionId]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);" (0723d8ff)
2025-11-05T11:56:20.5977478+02:00 0HNGSA64NS4UB:0000000F [ERR] An exception occurred in the database while saving changes for context type '"E_Prescribing_API.Data.ApplicationDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_Prescriptions_Patients_PatientId\". The conflict occurred in database \"E_Prescribing_API\", table \"dbo.Patients\", column 'PatientId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e54a5ab2-89ad-4bb1-b2cb-25be2ec3d24a
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Prescriptions_Patients_PatientId". The conflict occurred in database "E_Prescribing_API", table "dbo.Patients", column 'PatientId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e54a5ab2-89ad-4bb1-b2cb-25be2ec3d24a
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication(PrescriptionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\PrescriptionController.cs:line 73
2025-11-05T11:56:20.7075746+02:00 0HNGSA64NS4UB:0000000F [ERR] Error while prescribing medication (7f31f151)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Prescriptions_Patients_PatientId". The conflict occurred in database "E_Prescribing_API", table "dbo.Patients", column 'PatientId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e54a5ab2-89ad-4bb1-b2cb-25be2ec3d24a
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication(PrescriptionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\PrescriptionController.cs:line 73
2025-11-05T11:56:20.7115223+02:00 0HNGSA64NS4UB:0000000F [INF] Executing "ObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T11:56:20.7147873+02:00 0HNGSA64NS4UB:0000000F [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 2275.7432ms (afa2e885)
2025-11-05T11:56:20.7151793+02:00 0HNGSA64NS4UB:0000000F [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T11:56:20.7231076+02:00 0HNGSA64NS4UB:0000000F [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 500 null "text/plain; charset=utf-8" 2316.8266ms (74253ad3)
2025-11-05T12:00:54.3332103+02:00 0HNGSA64NS4UC:00000003 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1497 (d509f86a)
2025-11-05T12:00:54.3353534+02:00 0HNGSA64NS4UC:00000003 [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T12:00:54.3357079+02:00 0HNGSA64NS4UC:00000003 [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T12:00:54.3675266+02:00 0HNGSA64NS4UC:00000003 [INF] Executed DbCommand ("5"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [m].[StaffId], [m].[ContactNumber], [m].[FacilityId], [m].[FullName], [m].[Name], [m].[RegistrationNumber], [m].[Surname], [m].[UserId]
FROM [MedicalStaffs] AS [m]
WHERE [m].[UserId] = 10" (0723d8ff)
2025-11-05T12:00:54.4281502+02:00 0HNGSA64NS4UC:00000003 [INF] Executed DbCommand ("55"ms) [Parameters=["@__8__locals1_patientId_0='?' (DbType = Int32), @__medicationIdsList_1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SELECT [t].[IngredientName], [t].[MedicationName]
FROM (
    SELECT DISTINCT [a].[Name] AS [IngredientName], [m0].[Name] AS [MedicationName]
    FROM [PatientAllergies] AS [p]
    INNER JOIN [MedicationIngredients] AS [m] ON [p].[ActiveIngredientId] = [m].[ActiveIngredientId]
    INNER JOIN [ActiveIngredients] AS [a] ON [m].[ActiveIngredientId] = [a].[IngredientId]
    INNER JOIN [Medications] AS [m0] ON [m].[MedicationId] = [m0].[MedicationId]
    WHERE [p].[PatientId] = @__8__locals1_patientId_0 AND [m].[MedicationId] IN (
        SELECT [m1].[value]
        FROM OPENJSON(@__medicationIdsList_1) WITH ([value] int '$') AS [m1]
    )
) AS [t]" (0723d8ff)
2025-11-05T12:00:54.4602814+02:00 0HNGSA64NS4UC:00000003 [INF] Executed DbCommand ("28"ms) [Parameters=["@__patientId_0='?' (DbType = Int32), @__medicationIdsList_1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SELECT [t].[Name]
FROM (
    SELECT DISTINCT [a].[Name]
    FROM [ContraIndications] AS [c]
    INNER JOIN [ActiveIngredients] AS [a] ON [c].[ActiveIngredientId] = [a].[IngredientId]
    INNER JOIN [MedicationIngredients] AS [m] ON [a].[IngredientId] = [m].[ActiveIngredientId]
    INNER JOIN [PatientConditions] AS [p] ON @__patientId_0 = [p].[PatientId] AND [c].[ConditionDiagnosisId] = [p].[ConditionId]
    WHERE [m].[MedicationId] IN (
        SELECT [m0].[value]
        FROM OPENJSON(@__medicationIdsList_1) WITH ([value] int '$') AS [m0]
    )
) AS [t]" (0723d8ff)
2025-11-05T12:00:54.5087547+02:00 0HNGSA64NS4UC:00000003 [INF] Executed DbCommand ("43"ms) [Parameters=["@__newMedicationIdsList_1='?' (Size = 4000), @__8__locals1_patientId_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT DISTINCT [m1].[Description]
FROM [PatientMedications] AS [p]
INNER JOIN [MedicationIngredients] AS [m] ON [p].[MedicationId] = [m].[MedicationId]
INNER JOIN (
    SELECT [m0].[ActiveIngredientId]
    FROM [MedicationIngredients] AS [m0]
    WHERE [m0].[MedicationId] IN (
        SELECT [n].[value]
        FROM OPENJSON(@__newMedicationIdsList_1) WITH ([value] int '$') AS [n]
    )
) AS [t] ON [m].[ActiveIngredientId] <> [t].[ActiveIngredientId]
CROSS JOIN [MedicationInteractions] AS [m1]
WHERE [p].[PatientId] = @__8__locals1_patientId_0 AND (([m1].[ActiveIngredient1Id] = [m].[ActiveIngredientId] AND [m1].[ActiveIngredient2Id] = [t].[ActiveIngredientId]) OR ([m1].[ActiveIngredient1Id] = [t].[ActiveIngredientId] AND [m1].[ActiveIngredient2Id] = [m].[ActiveIngredientId]))" (0723d8ff)
2025-11-05T12:00:54.5250705+02:00 0HNGSA64NS4UC:00000003 [INF] Executed DbCommand ("8"ms) [Parameters=["@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Prescriptions] ([Date], [DispenserId], [IsUrgent], [Note], [PatientId], [PrescriberId], [Status])
OUTPUT INSERTED.[PrescriptionId]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);" (0723d8ff)
2025-11-05T12:00:54.5846406+02:00 0HNGSA64NS4UC:00000003 [INF] Executed DbCommand ("6"ms) [Parameters=["@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PrescribedMedications] ([Instruction], [MedicationId], [PrescriptionId], [Quantity])
OUTPUT INSERTED.[PrescribedMedicationId]
VALUES (@p0, @p1, @p2, @p3);" (0723d8ff)
2025-11-05T12:00:54.5883496+02:00 0HNGSA64NS4UC:00000003 [INF] Executing "OkObjectResult", writing value of type '"<>f__AnonymousType11`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]"'. (605b4265)
2025-11-05T12:00:54.5942613+02:00 0HNGSA64NS4UC:00000003 [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 258.4158ms (afa2e885)
2025-11-05T12:00:54.5943583+02:00 0HNGSA64NS4UC:00000003 [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T12:00:54.5946767+02:00 0HNGSA64NS4UC:00000003 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 200 null "application/json; charset=utf-8" 262.9278ms (74253ad3)
2025-11-05T13:12:58.2803733+02:00  [INF] User profile is available. Using '"C:\Users\ThatoTs\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest. (7ac5e29c)
2025-11-05T13:12:58.5643874+02:00  [INF] Now listening on: "https://localhost:7150" (d826f4b8)
2025-11-05T13:12:58.5664772+02:00  [INF] Now listening on: "http://localhost:5031" (d826f4b8)
2025-11-05T13:12:58.6125040+02:00  [INF] Application started. Press Ctrl+C to shut down. (dcaefe54)
2025-11-05T13:12:58.6155896+02:00  [INF] Hosting environment: "Development" (bc5a1a4e)
2025-11-05T13:12:58.6190619+02:00  [INF] Content root path: "D:\HomeSpace\E_Prescribing_API\E_Prescribing_API" (cc26f24e)
2025-11-05T13:12:59.3815934+02:00 0HNGSBH3G5BLD:00000003 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - null null (d509f86a)
2025-11-05T13:12:59.5836249+02:00 0HNGSBH3G5BLD:00000003 [INF] "Identity.Application" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:12:59.5886198+02:00 0HNGSBH3G5BLD:00000003 [INF] "Identity.BearerAndApplication" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:12:59.6023353+02:00 0HNGSBH3G5BLD:00000003 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - 301 0 null 227.5326ms (74253ad3)
2025-11-05T13:12:59.6105405+02:00 0HNGSBH3G5BLD:00000005 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - null null (d509f86a)
2025-11-05T13:12:59.6212303+02:00 0HNGSBH3G5BLD:00000005 [INF] "Identity.Application" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:12:59.6239011+02:00 0HNGSBH3G5BLD:00000005 [INF] "Identity.BearerAndApplication" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:12:59.6877486+02:00 0HNGSBH3G5BLD:00000005 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - 200 null "text/html;charset=utf-8" 77.2647ms (74253ad3)
2025-11-05T13:12:59.7041751+02:00 0HNGSBH3G5BLD:00000007 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - null null (d509f86a)
2025-11-05T13:12:59.7047605+02:00 0HNGSBH3G5BLD:00000009 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - null null (d509f86a)
2025-11-05T13:12:59.7054540+02:00 0HNGSBH3G5BLD:0000000B [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - null null (d509f86a)
2025-11-05T13:12:59.7084720+02:00 0HNGSBH3G5BLD:00000009 [INF] "Identity.Application" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:12:59.7124705+02:00 0HNGSBH3G5BLD:00000009 [INF] "Identity.BearerAndApplication" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:12:59.7223397+02:00 0HNGSBH3G5BLD:00000007 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - 200 13770 "application/javascript; charset=utf-8" 18.6598ms (74253ad3)
2025-11-05T13:12:59.7322531+02:00 0HNGSBH3G5BLD:00000009 [INF] Sending file. Request path: '"/swagger-ui.css"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T13:12:59.7324999+02:00 0HNGSBH3G5BLD:00000009 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - 499 152034 "text/css" 27.7637ms (74253ad3)
2025-11-05T13:12:59.7714015+02:00 0HNGSBH3G5BLD:0000000B [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - 200 null "text/javascript; charset=UTF-8" 65.9732ms (74253ad3)
2025-11-05T13:12:59.8098898+02:00 0HNGSBH3G5BLD:0000000D [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-16x16.png""" - null null (d509f86a)
2025-11-05T13:12:59.8109180+02:00 0HNGSBH3G5BLD:0000000D [INF] "Identity.Application" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:12:59.8141165+02:00 0HNGSBH3G5BLD:0000000D [INF] "Identity.BearerAndApplication" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:12:59.8153793+02:00 0HNGSBH3G5BLD:0000000D [INF] Sending file. Request path: '"/favicon-16x16.png"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T13:12:59.8155968+02:00 0HNGSBH3G5BLD:0000000D [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-16x16.png""" - 499 665 "image/png" 6.6236ms (74253ad3)
2025-11-05T13:12:59.8642176+02:00 0HNGSBH3G5BLD:0000000F [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - null null (d509f86a)
2025-11-05T13:12:59.8655730+02:00 0HNGSBH3G5BLD:0000000F [INF] "Identity.Application" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:12:59.8753789+02:00 0HNGSBH3G5BLD:0000000F [INF] "Identity.BearerAndApplication" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:00.0291005+02:00 0HNGSBH3G5BLD:0000000F [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - 200 null "application/json;charset=utf-8" 165.4386ms (74253ad3)
2025-11-05T13:13:18.2005871+02:00  [INF] User profile is available. Using '"C:\Users\ThatoTs\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest. (7ac5e29c)
2025-11-05T13:13:18.5783042+02:00  [INF] Now listening on: "https://localhost:7150" (d826f4b8)
2025-11-05T13:13:18.5810323+02:00  [INF] Now listening on: "http://localhost:5031" (d826f4b8)
2025-11-05T13:13:18.6666811+02:00  [INF] Application started. Press Ctrl+C to shut down. (dcaefe54)
2025-11-05T13:13:18.6691296+02:00  [INF] Hosting environment: "Development" (bc5a1a4e)
2025-11-05T13:13:18.6714957+02:00  [INF] Content root path: "D:\HomeSpace\E_Prescribing_API\E_Prescribing_API" (cc26f24e)
2025-11-05T13:13:19.4827249+02:00 0HNGSBH9FMCPR:00000003 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - null null (d509f86a)
2025-11-05T13:13:19.6646724+02:00 0HNGSBH9FMCPR:00000003 [INF] "Identity.Application" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:19.6706089+02:00 0HNGSBH9FMCPR:00000003 [INF] "Identity.BearerAndApplication" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:19.6857990+02:00 0HNGSBH9FMCPR:00000003 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - 301 0 null 211.132ms (74253ad3)
2025-11-05T13:13:19.6955399+02:00 0HNGSBH9FMCPR:00000005 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - null null (d509f86a)
2025-11-05T13:13:19.7072516+02:00 0HNGSBH9FMCPR:00000005 [INF] "Identity.Application" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:19.7105240+02:00 0HNGSBH9FMCPR:00000005 [INF] "Identity.BearerAndApplication" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:19.7942091+02:00 0HNGSBH9FMCPR:00000005 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - 200 null "text/html;charset=utf-8" 98.8344ms (74253ad3)
2025-11-05T13:13:19.8222708+02:00 0HNGSBH9FMCPR:00000007 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - null null (d509f86a)
2025-11-05T13:13:19.8254257+02:00 0HNGSBH9FMCPR:00000009 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - null null (d509f86a)
2025-11-05T13:13:19.8398793+02:00 0HNGSBH9FMCPR:00000009 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - 200 13770 "application/javascript; charset=utf-8" 14.6639ms (74253ad3)
2025-11-05T13:13:19.8940976+02:00 0HNGSBH9FMCPR:00000007 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - 200 null "text/javascript; charset=UTF-8" 71.99ms (74253ad3)
2025-11-05T13:13:19.9425244+02:00 0HNGSBH9FMCPR:0000000B [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-32x32.png""" - null null (d509f86a)
2025-11-05T13:13:19.9458012+02:00 0HNGSBH9FMCPR:0000000B [INF] "Identity.Application" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:19.9500531+02:00 0HNGSBH9FMCPR:0000000B [INF] "Identity.BearerAndApplication" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:19.9612319+02:00 0HNGSBH9FMCPR:0000000B [INF] Sending file. Request path: '"/favicon-32x32.png"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T13:13:19.9614453+02:00 0HNGSBH9FMCPR:0000000B [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-32x32.png""" - 499 628 "image/png" 19.1296ms (74253ad3)
2025-11-05T13:13:19.9960682+02:00 0HNGSBH9FMCPR:0000000D [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - null null (d509f86a)
2025-11-05T13:13:19.9968100+02:00 0HNGSBH9FMCPR:0000000D [INF] "Identity.Application" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:20.0000844+02:00 0HNGSBH9FMCPR:0000000D [INF] "Identity.BearerAndApplication" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:20.1496725+02:00 0HNGSBH9FMCPR:0000000D [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - 200 null "application/json;charset=utf-8" 153.8747ms (74253ad3)
2025-11-05T13:13:47.1912902+02:00 0HNGSBH9FMCPR:0000000F [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - "application/json" 1497 (d509f86a)
2025-11-05T13:13:47.2166086+02:00 0HNGSBH9FMCPR:0000000F [INF] "Identity.Application" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:47.2208424+02:00 0HNGSBH9FMCPR:0000000F [INF] "Identity.BearerAndApplication" was not authenticated. Failure message: "Unprotect ticket failed" (48071232)
2025-11-05T13:13:47.2383684+02:00 0HNGSBH9FMCPR:0000000F [INF] Executing endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (500cc934)
2025-11-05T13:13:47.2990940+02:00 0HNGSBH9FMCPR:0000000F [INF] Route matched with "{action = \"PrescribeMedication\", controller = \"Prescription\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] PrescribeMedication(E_Prescribing_API.CollectionModel.PrescriptionCollection)" on controller "E_Prescribing_API.Controllers.PrescriptionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T13:13:52.8301761+02:00 0HNGSBH9FMCPR:0000000F [INF] Executed DbCommand ("76"ms) [Parameters=[""], CommandType='Text', CommandTimeout='30']"
""SELECT TOP(1) [m].[StaffId], [m].[ContactNumber], [m].[FacilityId], [m].[FullName], [m].[Name], [m].[RegistrationNumber], [m].[Surname], [m].[UserId]
FROM [MedicalStaffs] AS [m]
WHERE [m].[UserId] = 10" (0723d8ff)
2025-11-05T13:13:53.5525047+02:00 0HNGSBH9FMCPR:0000000F [INF] Executed DbCommand ("91"ms) [Parameters=["@__8__locals1_patientId_0='?' (DbType = Int32), @__medicationIdsList_1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SELECT [t].[IngredientName], [t].[MedicationName]
FROM (
    SELECT DISTINCT [a].[Name] AS [IngredientName], [m0].[Name] AS [MedicationName]
    FROM [PatientAllergies] AS [p]
    INNER JOIN [MedicationIngredients] AS [m] ON [p].[ActiveIngredientId] = [m].[ActiveIngredientId]
    INNER JOIN [ActiveIngredients] AS [a] ON [m].[ActiveIngredientId] = [a].[IngredientId]
    INNER JOIN [Medications] AS [m0] ON [m].[MedicationId] = [m0].[MedicationId]
    WHERE [p].[PatientId] = @__8__locals1_patientId_0 AND [m].[MedicationId] IN (
        SELECT [m1].[value]
        FROM OPENJSON(@__medicationIdsList_1) WITH ([value] int '$') AS [m1]
    )
) AS [t]" (0723d8ff)
2025-11-05T13:13:53.6130493+02:00 0HNGSBH9FMCPR:0000000F [INF] Executed DbCommand ("29"ms) [Parameters=["@__patientId_0='?' (DbType = Int32), @__medicationIdsList_1='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SELECT [t].[Name]
FROM (
    SELECT DISTINCT [a].[Name]
    FROM [ContraIndications] AS [c]
    INNER JOIN [ActiveIngredients] AS [a] ON [c].[ActiveIngredientId] = [a].[IngredientId]
    INNER JOIN [MedicationIngredients] AS [m] ON [a].[IngredientId] = [m].[ActiveIngredientId]
    INNER JOIN [PatientConditions] AS [p] ON @__patientId_0 = [p].[PatientId] AND [c].[ConditionDiagnosisId] = [p].[ConditionId]
    WHERE [m].[MedicationId] IN (
        SELECT [m0].[value]
        FROM OPENJSON(@__medicationIdsList_1) WITH ([value] int '$') AS [m0]
    )
) AS [t]" (0723d8ff)
2025-11-05T13:13:53.7052816+02:00 0HNGSBH9FMCPR:0000000F [INF] Executed DbCommand ("36"ms) [Parameters=["@__newMedicationIdsList_1='?' (Size = 4000), @__8__locals1_patientId_0='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SELECT DISTINCT [m1].[Description]
FROM [PatientMedications] AS [p]
INNER JOIN [MedicationIngredients] AS [m] ON [p].[MedicationId] = [m].[MedicationId]
INNER JOIN (
    SELECT [m0].[ActiveIngredientId]
    FROM [MedicationIngredients] AS [m0]
    WHERE [m0].[MedicationId] IN (
        SELECT [n].[value]
        FROM OPENJSON(@__newMedicationIdsList_1) WITH ([value] int '$') AS [n]
    )
) AS [t] ON [m].[ActiveIngredientId] <> [t].[ActiveIngredientId]
CROSS JOIN [MedicationInteractions] AS [m1]
WHERE [p].[PatientId] = @__8__locals1_patientId_0 AND (([m1].[ActiveIngredient1Id] = [m].[ActiveIngredientId] AND [m1].[ActiveIngredient2Id] = [t].[ActiveIngredientId]) OR ([m1].[ActiveIngredient1Id] = [t].[ActiveIngredientId] AND [m1].[ActiveIngredient2Id] = [m].[ActiveIngredientId]))" (0723d8ff)
2025-11-05T13:13:54.2829516+02:00 0HNGSBH9FMCPR:0000000F [INF] Executed DbCommand ("11"ms) [Parameters=["@p0='?' (DbType = DateTime2), @p1='?' (DbType = Int32), @p2='?' (DbType = Boolean), @p3='?' (Size = 4000), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (Size = 4000)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Prescriptions] ([Date], [DispenserId], [IsUrgent], [Note], [PatientId], [PrescriberId], [Status])
OUTPUT INSERTED.[PrescriptionId]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6);" (0723d8ff)
2025-11-05T13:13:55.4625245+02:00 0HNGSBH9FMCPR:0000000F [INF] Executed DbCommand ("520"ms) [Parameters=["@p0='?' (Size = 4000), @p1='?' (DbType = Int32), @p2='?' (DbType = Int32), @p3='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PrescribedMedications] ([Instruction], [MedicationId], [PrescriptionId], [Quantity])
OUTPUT INSERTED.[PrescribedMedicationId]
VALUES (@p0, @p1, @p2, @p3);" (0723d8ff)
2025-11-05T13:13:55.4790339+02:00 0HNGSBH9FMCPR:0000000F [INF] Executing "OkObjectResult", writing value of type '"<>f__AnonymousType11`2[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]"'. (605b4265)
2025-11-05T13:13:55.4954441+02:00 0HNGSBH9FMCPR:0000000F [INF] Executed action "E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)" in 8189.0098ms (afa2e885)
2025-11-05T13:13:55.4962976+02:00 0HNGSBH9FMCPR:0000000F [INF] Executed endpoint '"E_Prescribing_API.Controllers.PrescriptionController.PrescribeMedication (E_Prescribing_API)"' (99874f2b)
2025-11-05T13:13:55.6200247+02:00 0HNGSBH9FMCPR:0000000F [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Prescription""" - 200 null "application/json; charset=utf-8" 8430.7806ms (74253ad3)
