2025-11-05T00:46:36.3192596+02:00  [INF] User profile is available. Using '"C:\Users\ThatoTs\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest. (7ac5e29c)
2025-11-05T00:46:36.5987102+02:00  [INF] Now listening on: "https://localhost:7150" (d826f4b8)
2025-11-05T00:46:36.6009914+02:00  [INF] Now listening on: "http://localhost:5031" (d826f4b8)
2025-11-05T00:46:36.6613447+02:00  [INF] Application started. Press Ctrl+C to shut down. (dcaefe54)
2025-11-05T00:46:36.6645528+02:00  [INF] Hosting environment: "Development" (bc5a1a4e)
2025-11-05T00:46:36.6666270+02:00  [INF] Content root path: "D:\HomeSpace\E_Prescribing_API\E_Prescribing_API" (cc26f24e)
2025-11-05T00:46:37.7616136+02:00 0HNGRUG1CHN2J:00000003 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - null null (d509f86a)
2025-11-05T00:46:37.9390621+02:00 0HNGRUG1CHN2J:00000003 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - 301 0 null 185.1067ms (74253ad3)
2025-11-05T00:46:37.9654914+02:00 0HNGRUG1CHN2J:00000005 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - null null (d509f86a)
2025-11-05T00:46:38.0470335+02:00 0HNGRUG1CHN2J:00000005 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - 200 null "text/html;charset=utf-8" 81.6553ms (74253ad3)
2025-11-05T00:46:38.0823017+02:00 0HNGRUG1CHN2J:00000007 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - null null (d509f86a)
2025-11-05T00:46:38.0870981+02:00 0HNGRUG1CHN2J:00000007 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - 200 13770 "application/javascript; charset=utf-8" 5.2138ms (74253ad3)
2025-11-05T00:46:38.0898921+02:00 0HNGRUG1CHN2J:00000009 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - null null (d509f86a)
2025-11-05T00:46:38.0923144+02:00 0HNGRUG1CHN2J:0000000B [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - null null (d509f86a)
2025-11-05T00:46:38.1066873+02:00 0HNGRUG1CHN2J:00000009 [INF] Sending file. Request path: '"/swagger-ui.css"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T00:46:38.1069510+02:00 0HNGRUG1CHN2J:00000009 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - 499 152034 "text/css" 17.3796ms (74253ad3)
2025-11-05T00:46:38.1367928+02:00 0HNGRUG1CHN2J:0000000B [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - 200 null "text/javascript; charset=UTF-8" 44.743ms (74253ad3)
2025-11-05T00:46:38.2103568+02:00 0HNGRUG1CHN2J:0000000D [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-32x32.png""" - null null (d509f86a)
2025-11-05T00:46:38.2117958+02:00 0HNGRUG1CHN2J:0000000D [INF] Sending file. Request path: '"/favicon-32x32.png"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T00:46:38.2119147+02:00 0HNGRUG1CHN2J:0000000D [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-32x32.png""" - 200 628 "image/png" 1.973ms (74253ad3)
2025-11-05T00:46:38.2458935+02:00 0HNGRUG1CHN2J:0000000F [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - null null (d509f86a)
2025-11-05T00:46:38.3441562+02:00 0HNGRUG1CHN2J:0000000F [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - 200 null "application/json;charset=utf-8" 98.6682ms (74253ad3)
2025-11-05T00:51:51.9201361+02:00  [INF] User profile is available. Using '"C:\Users\ThatoTs\AppData\Local\ASP.NET\DataProtection-Keys"' as key repository and Windows DPAPI to encrypt keys at rest. (7ac5e29c)
2025-11-05T00:51:52.2323762+02:00  [INF] Now listening on: "https://localhost:7150" (d826f4b8)
2025-11-05T00:51:52.2347041+02:00  [INF] Now listening on: "http://localhost:5031" (d826f4b8)
2025-11-05T00:51:52.3307585+02:00  [INF] Application started. Press Ctrl+C to shut down. (dcaefe54)
2025-11-05T00:51:52.3337238+02:00  [INF] Hosting environment: "Development" (bc5a1a4e)
2025-11-05T00:51:52.3360420+02:00  [INF] Content root path: "D:\HomeSpace\E_Prescribing_API\E_Prescribing_API" (cc26f24e)
2025-11-05T00:51:53.6805378+02:00 0HNGRUIVGES83:00000003 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - null null (d509f86a)
2025-11-05T00:51:53.8425818+02:00 0HNGRUIVGES83:00000003 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger""" - 301 0 null 166.6386ms (74253ad3)
2025-11-05T00:51:53.8533032+02:00 0HNGRUIVGES83:00000005 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - null null (d509f86a)
2025-11-05T00:51:53.9583196+02:00 0HNGRUIVGES83:00000005 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/index.html""" - 200 null "text/html;charset=utf-8" 105.1202ms (74253ad3)
2025-11-05T00:51:53.9930478+02:00 0HNGRUIVGES83:00000007 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - null null (d509f86a)
2025-11-05T00:51:53.9969185+02:00 0HNGRUIVGES83:00000009 [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - null null (d509f86a)
2025-11-05T00:51:54.0070249+02:00 0HNGRUIVGES83:0000000B [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - null null (d509f86a)
2025-11-05T00:51:54.0079383+02:00 0HNGRUIVGES83:00000007 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_framework/aspnetcore-browser-refresh.js""" - 200 13770 "application/javascript; charset=utf-8" 15.2766ms (74253ad3)
2025-11-05T00:51:54.0243685+02:00 0HNGRUIVGES83:00000009 [INF] Sending file. Request path: '"/swagger-ui.css"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T00:51:54.0244957+02:00 0HNGRUIVGES83:00000009 [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/swagger-ui.css""" - 499 152034 "text/css" 27.8896ms (74253ad3)
2025-11-05T00:51:54.0658184+02:00 0HNGRUIVGES83:0000000B [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/_vs/browserLink""" - 200 null "text/javascript; charset=UTF-8" 59.1824ms (74253ad3)
2025-11-05T00:51:54.1672917+02:00 0HNGRUIVGES83:0000000D [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-32x32.png""" - null null (d509f86a)
2025-11-05T00:51:54.1698100+02:00 0HNGRUIVGES83:0000000D [INF] Sending file. Request path: '"/favicon-32x32.png"'. Physical path: '"N/A"' (27b0a520)
2025-11-05T00:51:54.1699991+02:00 0HNGRUIVGES83:0000000D [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/favicon-32x32.png""" - 499 628 "image/png" 2.862ms (74253ad3)
2025-11-05T00:51:54.2114434+02:00 0HNGRUIVGES83:0000000F [INF] Request starting "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - null null (d509f86a)
2025-11-05T00:51:54.3680286+02:00 0HNGRUIVGES83:0000000F [INF] Request finished "HTTP/2" "GET" "https"://"localhost:7150""""/swagger/v1/swagger.json""" - 200 null "application/json;charset=utf-8" 156.8897ms (74253ad3)
2025-11-05T00:56:41.7733327+02:00 0HNGRUIVGES84:00000003 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T00:56:41.7888823+02:00 0HNGRUIVGES84:00000003 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T00:56:41.8271843+02:00 0HNGRUIVGES84:00000003 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T00:56:42.1712981+02:00 0HNGRUIVGES84:00000003 [WRN] Unknown step 0 in admission process (4e65c9b0)
2025-11-05T00:56:42.1780760+02:00 0HNGRUIVGES84:00000003 [INF] Executing "BadRequestObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T00:56:42.1848834+02:00 0HNGRUIVGES84:00000003 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 352.2051ms (afa2e885)
2025-11-05T00:56:42.1850630+02:00 0HNGRUIVGES84:00000003 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T00:56:42.1871661+02:00 0HNGRUIVGES84:00000003 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 400 null "text/plain; charset=utf-8" 414.0353ms (74253ad3)
2025-11-05T00:57:13.9504944+02:00 0HNGRUIVGES84:00000005 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T00:57:13.9520591+02:00 0HNGRUIVGES84:00000005 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T00:57:13.9522876+02:00 0HNGRUIVGES84:00000005 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T00:57:15.9800047+02:00 0HNGRUIVGES84:00000005 [INF] Executed DbCommand ("100"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PatientMedications] ([MedicationId], [PatientId])
OUTPUT INSERTED.[PatientMedicationId]
VALUES (@p0, @p1);" (0723d8ff)
2025-11-05T00:57:16.0815007+02:00 0HNGRUIVGES84:00000005 [ERR] An exception occurred in the database while saving changes for context type '"E_Prescribing_API.Data.ApplicationDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_PatientMedications_Medications_MedicationId\". The conflict occurred in database \"E_Prescribing_API\", table \"dbo.Medications\", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.TaskAwaiter`1.GetResult()
2025-11-05T00:57:16.1887891+02:00 0HNGRUIVGES84:00000005 [ERR] Error while admitting patient (a2588e81)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T00:57:16.1923142+02:00 0HNGRUIVGES84:00000005 [INF] Executing "ObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T00:57:16.1935820+02:00 0HNGRUIVGES84:00000005 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 2241.029ms (afa2e885)
2025-11-05T00:57:16.1940891+02:00 0HNGRUIVGES84:00000005 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T00:57:16.2006312+02:00 0HNGRUIVGES84:00000005 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 500 null "text/plain; charset=utf-8" 2250.1964ms (74253ad3)
2025-11-05T00:58:21.1338264+02:00 0HNGRUIVGES84:00000007 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T00:58:21.1397582+02:00 0HNGRUIVGES84:00000007 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T00:58:21.1398867+02:00 0HNGRUIVGES84:00000007 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T00:58:21.2404342+02:00 0HNGRUIVGES84:00000007 [INF] Executed DbCommand ("10"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PatientMedications] ([MedicationId], [PatientId])
OUTPUT INSERTED.[PatientMedicationId]
VALUES (@p0, @p1);" (0723d8ff)
2025-11-05T00:58:21.2579108+02:00 0HNGRUIVGES84:00000007 [ERR] An exception occurred in the database while saving changes for context type '"E_Prescribing_API.Data.ApplicationDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_PatientMedications_Medications_MedicationId\". The conflict occurred in database \"E_Prescribing_API\", table \"dbo.Medications\", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T00:58:21.3226496+02:00 0HNGRUIVGES84:00000007 [ERR] Error while admitting patient (a2588e81)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T00:58:21.3230246+02:00 0HNGRUIVGES84:00000007 [INF] Executing "ObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T00:58:21.3231432+02:00 0HNGRUIVGES84:00000007 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 183.2159ms (afa2e885)
2025-11-05T00:58:21.3231721+02:00 0HNGRUIVGES84:00000007 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T00:58:21.3234139+02:00 0HNGRUIVGES84:00000007 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 500 null "text/plain; charset=utf-8" 189.7282ms (74253ad3)
2025-11-05T01:00:02.8208090+02:00 0HNGRUIVGES84:00000009 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T01:00:02.8263404+02:00 0HNGRUIVGES84:00000009 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T01:00:02.8264677+02:00 0HNGRUIVGES84:00000009 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T01:00:02.8550187+02:00 0HNGRUIVGES84:00000009 [INF] Executed DbCommand ("8"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PatientMedications] ([MedicationId], [PatientId])
OUTPUT INSERTED.[PatientMedicationId]
VALUES (@p0, @p1);" (0723d8ff)
2025-11-05T01:00:02.8746715+02:00 0HNGRUIVGES84:00000009 [ERR] An exception occurred in the database while saving changes for context type '"E_Prescribing_API.Data.ApplicationDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_PatientMedications_Medications_MedicationId\". The conflict occurred in database \"E_Prescribing_API\", table \"dbo.Medications\", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T01:00:02.9691450+02:00 0HNGRUIVGES84:00000009 [ERR] Error while admitting patient (a2588e81)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ae53ee54-af8b-4c76-8d15-5b9c9da0d8c1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T01:00:02.9693497+02:00 0HNGRUIVGES84:00000009 [INF] Executing "ObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T01:00:02.9694791+02:00 0HNGRUIVGES84:00000009 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 142.9769ms (afa2e885)
2025-11-05T01:00:02.9695158+02:00 0HNGRUIVGES84:00000009 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T01:00:02.9698245+02:00 0HNGRUIVGES84:00000009 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 500 null "text/plain; charset=utf-8" 149.1773ms (74253ad3)
2025-11-05T01:05:04.2796764+02:00 0HNGRUIVGES85:00000003 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T01:05:04.2803568+02:00 0HNGRUIVGES85:00000003 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T01:05:04.2809086+02:00 0HNGRUIVGES85:00000003 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T01:05:04.3358050+02:00 0HNGRUIVGES85:00000003 [INF] Executed DbCommand ("10"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PatientMedications] ([MedicationId], [PatientId])
OUTPUT INSERTED.[PatientMedicationId]
VALUES (@p0, @p1);" (0723d8ff)
2025-11-05T01:05:04.3701521+02:00 0HNGRUIVGES85:00000003 [ERR] An exception occurred in the database while saving changes for context type '"E_Prescribing_API.Data.ApplicationDbContext"'."
""Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint \"FK_PatientMedications_Medications_MedicationId\". The conflict occurred in database \"E_Prescribing_API\", table \"dbo.Medications\", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:08eb5cb3-f1ec-43e5-912e-3856719ea523
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)" (170f029e)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:08eb5cb3-f1ec-43e5-912e-3856719ea523
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T01:05:04.4510513+02:00 0HNGRUIVGES85:00000003 [ERR] Error while admitting patient (a2588e81)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_PatientMedications_Medications_MedicationId". The conflict occurred in database "E_Prescribing_API", table "dbo.Medications", column 'MedicationId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:08eb5cb3-f1ec-43e5-912e-3856719ea523
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at E_Prescribing_API.Controllers.AdmissionController.AdmitPatient(AdmissionCollection model) in D:\HomeSpace\E_Prescribing_API\E_Prescribing_API\Controllers\AdmissionController.cs:line 76
2025-11-05T01:05:04.4513055+02:00 0HNGRUIVGES85:00000003 [INF] Executing "ObjectResult", writing value of type '"System.String"'. (605b4265)
2025-11-05T01:05:04.4514319+02:00 0HNGRUIVGES85:00000003 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 170.4721ms (afa2e885)
2025-11-05T01:05:04.4514799+02:00 0HNGRUIVGES85:00000003 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T01:05:04.4516850+02:00 0HNGRUIVGES85:00000003 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 500 null "text/plain; charset=utf-8" 172.9998ms (74253ad3)
2025-11-05T01:06:51.7180142+02:00 0HNGRUIVGES85:00000005 [INF] Request starting "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - "application/json" 861 (d509f86a)
2025-11-05T01:06:51.7182923+02:00 0HNGRUIVGES85:00000005 [INF] Executing endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (500cc934)
2025-11-05T01:06:51.7183786+02:00 0HNGRUIVGES85:00000005 [INF] Route matched with "{action = \"AdmitPatient\", controller = \"Admission\"}". Executing controller action with signature "System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] AdmitPatient(E_Prescribing_API.CollectionModel.AdmissionCollection)" on controller "E_Prescribing_API.Controllers.AdmissionController" ("E_Prescribing_API"). (122b2fdf)
2025-11-05T01:06:51.7513192+02:00 0HNGRUIVGES85:00000005 [INF] Executed DbCommand ("28"ms) [Parameters=["@p0='?' (DbType = Int32), @p1='?' (DbType = Int32)"], CommandType='Text', CommandTimeout='30']"
""SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [PatientMedications] ([MedicationId], [PatientId])
OUTPUT INSERTED.[PatientMedicationId]
VALUES (@p0, @p1);" (0723d8ff)
2025-11-05T01:06:51.7873560+02:00 0HNGRUIVGES85:00000005 [INF] Executing "OkObjectResult", writing value of type '"<>f__AnonymousType8`3[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Collections.Generic.List`1[[System.Int32, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]"'. (605b4265)
2025-11-05T01:06:51.7946868+02:00 0HNGRUIVGES85:00000005 [INF] Executed action "E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)" in 76.2764ms (afa2e885)
2025-11-05T01:06:51.7947690+02:00 0HNGRUIVGES85:00000005 [INF] Executed endpoint '"E_Prescribing_API.Controllers.AdmissionController.AdmitPatient (E_Prescribing_API)"' (99874f2b)
2025-11-05T01:06:51.7949438+02:00 0HNGRUIVGES85:00000005 [INF] Request finished "HTTP/2" "POST" "https"://"localhost:7150""""/api/Admission/AdmitPatient""" - 200 null "application/json; charset=utf-8" 77.0151ms (74253ad3)
